
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>POS Dash | Responsive Bootstrap 4 Admin Dashboard Template</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="../../images/logo/favicon.ico" />
    <link rel="stylesheet" href="../../css/backend-plugin.min.css">
    <link rel="stylesheet" href="../../css/backend.css?v=1.0.0">
    <link rel="stylesheet" href="../../css/@fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../css/line-awesome/dist/line-awesome/css/line-awesome.min.css">
    <link rel="stylesheet" href="../../css/remixicon/fonts/remixicon.css">
    <body class="  ">
        <!-- loader Start -->
        <div id="loading">
            <div id="loading-center">
            </div>
        </div>
        <!-- loader END -->
        <!-- Wrapper Start -->
        <div class="wrapper">

            <!-- Nav -->
            <div id="nav-placeholder"></div>

            <!-- Header -->
            <div id="header-placeholder"></div>


            <div class="modal fade" id="new-order" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div class="popup text-left">
                                <h4 class="mb-3">New Order</h4>
                                <div class="content create-workform bg-body">
                                    <div class="pb-3">
                                        <label class="mb-2">Email</label>
                                        <input type="text" class="form-control" placeholder="Enter Name or Email">
                                    </div>
                                    <div class="col-lg-12 mt-4">
                                        <div class="d-flex flex-wrap align-items-ceter justify-content-center">
                                            <div class="btn btn-primary mr-4" data-dismiss="modal">Cancel</div>
                                            <div class="btn btn-outline-primary" data-dismiss="modal">Create</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>      <div class="content-page">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex flex-wrap flex-wrap align-items-center justify-content-between mb-4">
                                <div>
                                    <h4 class="mb-3">Product List</h4>
                                    <p class="mb-0">The product list effectively dictates product presentation and provides space<br> to list your products and offering in the most appealing way.</p>
                                </div>
                                <a href="page-add-product.html" class="btn btn-primary add-list"><i class="las la-plus mr-3"></i>Add Product</a>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="table-responsive rounded mb-3">

                                <!--Table data-->
                                <table id="productTable" class="table mb-0 tbl-server-info">
                                    <thead class="bg-white text-uppercase">
                                        <tr class="ligth ligth-data">
                                            <th>
                                                <div class="checkbox d-inline-block">
                                                    <input type="checkbox" class="checkbox-input" id="checkAll">
                                                    <label for="checkAll" class="mb-0"></label>
                                                </div>
                                            </th>
                                            <th id="sortName" style="cursor:pointer;">Product ⬍</th>
                                            <th id="sortId" style="cursor:pointer;">Code ⬍</th>
                                            <th>Category</th>
                                            <th id="sortPrice" style="cursor:pointer;">Price ⬍</th>
                                            <th>Quantity</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="ligth-body" id="tableBody">
                                        <!-- JS render rows -->
                                    </tbody>
                                </table>
                                <!-- Pagination -->

                                <nav aria-label="Page navigation">
                                    <ul style="padding-top:20px" class="pagination justify-content-center" id="pagination">
                                        <!-- JS render pagination buttons -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <!-- Page end  -->
                </div>
                <!-- Modal Edit -->
                <div class="modal fade" id="edit-note" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-body">
                                <div class="popup text-left">
                                    <div class="media align-items-top justify-content-between">
                                        <h3 class="mb-3">Product</h3>
                                        <div class="btn-cancel p-0" data-dismiss="modal"><i class="las la-times"></i></div>
                                    </div>
                                    <div class="content edit-notes">
                                        <div class="card card-transparent card-block card-stretch event-note mb-0">
                                            <div class="card-body px-0 bukmark">
                                                <div class="d-flex align-items-center justify-content-between pb-2 mb-3 border-bottom">
                                                    <div class="quill-tool">
                                                    </div>
                                                </div>
                                                <div id="quill-toolbar1">
                                                    <p>Virtual Digital Marketing Course every week on Monday, Wednesday and Saturday.Virtual Digital Marketing Course every week on Monday</p>
                                                </div>
                                            </div>
                                            <div class="card-footer border-0">
                                                <div class="d-flex flex-wrap align-items-ceter justify-content-end">
                                                    <div class="btn btn-primary mr-3" data-dismiss="modal">Cancel</div>
                                                    <div class="btn btn-outline-primary" data-dismiss="modal">Save</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Wrapper End-->
        <footer class="iq-footer">
            <div class="container-fluid">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-lg-6">
                                <ul class="list-inline mb-0">
                                    <li class="list-inline-item"><a href="../backend/privacy-policy.html">Privacy Policy</a></li>
                                    <li class="list-inline-item"><a href="../backend/terms-of-service.html">Terms of Use</a></li>
                                </ul>
                            </div>
                            <div class="col-lg-6 text-right">
                                <span class="mr-1">
                                    <script>document.write(new Date().getFullYear())</script>©
                                </span> <a href="#" class="">POS Dash</a>.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <script>fetch('nav.html').then(response => response.text()).then(data => { document.getElementById('nav-placeholder').innerHTML = data; });</script>
        <script>fetch('header.html').then(response => response.text()).then(data => { document.getElementById('header-placeholder').innerHTML = data; });</script> <!--nav--> <!--header--> <!-- Backend Bundle JavaScript -->


        <script>
            const API_BASE = "https://localhost:7062/api";
            let products = [];
            let currentSort = { key: null, asc: true };
            let currentPage = 1;
            let totalPages = 1;
            let pageSize = 10;

            // helper: fallback image
            function productImage(id) {
                return `${API_BASE.replace('/api', '')}/Image/products/${id}/primary.jpg`;
            }

            // load products from API
            async function loadProducts(pageNumber = 1, pageSizeParam = 10) {
                try {
                    currentPage = pageNumber;
                    pageSize = pageSizeParam;

                    const url = `${API_BASE}/Product?pageNumber=${pageNumber}&pageSize=${pageSize}&categoryId=0&min=0&max=500000&asc=true`;
                    const res = await fetch(url);
                    const json = await res.json();

                    if (!json.succeeded) {
                        console.error("API error:", json.message);
                        return;
                    }

                    products = json.data.items;
                    totalPages = json.data.totalPages || Math.ceil(json.data.totalCount / pageSize);

                    renderTable();
                    renderPagination();

                } catch (error) {
                    console.error("Fetch error:", error);
                }
            }

            // render table rows
            function renderTable() {
                const tbody = document.getElementById("tableBody");
                tbody.innerHTML = "";

                products.forEach(p => {
                    const tr = document.createElement("tr");
                    const photoUrl = `${API_BASE.replace('/api', '')}${p.url}`

                    tr.innerHTML = `
            <td>
                <div class="checkbox d-inline-block">
                    <input type="checkbox" class="checkbox-input row-check" id="checkbox_${p.id}">
                    <label for="checkbox_${p.id}" class="mb-0"></label>
                </div>
            </td>
            <td>
                <div class="d-flex align-items-center">
                    <img src="${photoUrl || productImage(p.id)}"
                         class="img-fluid rounded avatar-50 mr-3" alt="image">
                    <div>
                        ${p.name}
                    </div>
                </div>
            </td>
            <td>PRD${p.id}</td>
            <td>${p.categoryName || "-"}</td>
            <td>${p.price ? p.price.toLocaleString() + "₫" : "-"}</td>
            <td>${p.stock ?? 0}</td>
            <td>
                <div class="d-flex align-items-center list-action">
                    <a class="badge badge-info mr-2" data-toggle="tooltip" href="page-view-product.html" title="View"><i class="ri-eye-line mr-0"></i></a>
                    <a class="badge bg-success mr-2" data-toggle="tooltip" href="page-edit-product.html" title="Edit"><i class="ri-pencil-line mr-0"></i></a>
                </div>
            </td>
        `;
                    tbody.appendChild(tr);
                });
            }

            // render pagination
            function renderPagination() {
                const paginationEl = document.getElementById("pagination");
                paginationEl.innerHTML = "";

                // Previous button
                const prevLi = document.createElement("li");
                prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
                prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Previous</a>`;
                paginationEl.appendChild(prevLi);

                // Calculate page range to show
                let startPage = Math.max(1, currentPage - 2);
                let endPage = Math.min(totalPages, currentPage + 2);

                // Adjust range if we're near the beginning or end
                if (currentPage <= 3) {
                    endPage = Math.min(5, totalPages);
                }
                if (currentPage > totalPages - 3) {
                    startPage = Math.max(1, totalPages - 4);
                }

                // First page and ellipsis
                if (startPage > 1) {
                    const firstLi = document.createElement("li");
                    firstLi.className = "page-item";
                    firstLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(1)">1</a>`;
                    paginationEl.appendChild(firstLi);

                    if (startPage > 2) {
                        const ellipsisLi = document.createElement("li");
                        ellipsisLi.className = "page-item disabled";
                        ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                        paginationEl.appendChild(ellipsisLi);
                    }
                }

                // Page numbers
                for (let i = startPage; i <= endPage; i++) {
                    const li = document.createElement("li");
                    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                    paginationEl.appendChild(li);
                }

                // Last page and ellipsis
                if (endPage < totalPages) {
                    if (endPage < totalPages - 1) {
                        const ellipsisLi = document.createElement("li");
                        ellipsisLi.className = "page-item disabled";
                        ellipsisLi.innerHTML = `<span class="page-link">...</span>`;
                        paginationEl.appendChild(ellipsisLi);
                    }

                    const lastLi = document.createElement("li");
                    lastLi.className = "page-item";
                    lastLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${totalPages})">${totalPages}</a>`;
                    paginationEl.appendChild(lastLi);
                }

                // Next button
                const nextLi = document.createElement("li");
                nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
                nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Next</a>`;
                paginationEl.appendChild(nextLi);
            }

            // change page function
            function changePage(page) {
                if (page < 1 || page > totalPages || page === currentPage) return;
                loadProducts(page, pageSize);
            }

            // change page size
            function changePageSize(newPageSize) {
                pageSize = newPageSize;
                currentPage = 1; // Reset to first page when changing page size
                loadProducts(1, pageSize);
            }

            // sort function (updated to work with pagination)
            function sortBy(key) {
                if (currentSort.key === key) {
                    currentSort.asc = !currentSort.asc;
                } else {
                    currentSort = { key, asc: true };
                }

                // For client-side sorting of current page
                products.sort((a, b) => {
                    let valA = a[key], valB = b[key];
                    if (typeof valA === "string") valA = valA.toLowerCase();
                    if (typeof valB === "string") valB = valB.toLowerCase();
                    if (valA < valB) return currentSort.asc ? -1 : 1;
                    if (valA > valB) return currentSort.asc ? 1 : -1;
                    return 0;
                });
                renderTable();
            }

            // check/uncheck all
            document.getElementById("checkAll").addEventListener("change", function () {
                const checked = this.checked;
                document.querySelectorAll(".row-check").forEach(cb => cb.checked = checked);
            });

            // bind sorting
            document.getElementById("sortId").addEventListener("click", () => sortBy("id"));
            document.getElementById("sortName").addEventListener("click", () => sortBy("name"));
            document.getElementById("sortPrice").addEventListener("click", () => sortBy("price"));

            // initial load
            document.addEventListener("DOMContentLoaded", () => loadProducts());
        </script>


        <script src="../../js/admin/backend-bundle.min.js"></script> <!-- Table Treeview JavaScript -->
        <script src="../../js/admin/table-treeview.js"></script> <!-- Chart Custom JavaScript -->
        <script src="../../js/admin/customizer.js"></script> <!-- Chart Custom JavaScript -->
        <script async src="../../js/admin/chart-custom.js"></script> <!-- app JavaScript -->
        <script src="../../js/admin/app.js"></script>

    </body>
</html>