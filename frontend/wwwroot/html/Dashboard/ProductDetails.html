<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Quản Lý Sản Phẩm Hoa</title>
    <!-- Link đến file CSS được cung cấp -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="vendor.css">
    <style>
        /* Thay đổi giao diện bảng màu dựa trên hình ảnh mới */
        body {
            background-color: #EEE2DC; /* Màu nền chính */
            font-family: "Roboto", sans-serif;
        }
        .dashboard {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #EDC7B7; /* Màu nền bảng điều khiển */
            border: 1px solid #BAB2B5;
            border-radius: 5px;
            color: #123C69;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background-color: #fff;
        }
        th, td {
            padding: 10px;
            border: 1px solid #BAB2B5;
            text-align: left;
        }
        th {
            background-color: #AC3B61;
            color: #fff;
        }
        #sortBy, #sortCategory {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #BAB2B5;
            background-color: #fff;
            color: #123C69;
        }
        #pagination button {
            margin: 0 5px;
            padding: 5px 10px;
            background-color: #123C69;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 3px;
        }
        #pagination button:hover {
            background-color: #AC3B61;
        }
        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            background-color: #AC3B61;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 3px;
        }
        .action-btn:hover {
            background-color: #123C69;
        }
        h1 {
            color: #AC3B61;
        }

        /* Style cho modal chi tiết sản phẩm */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #EDC7B7;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #BAB2B5;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
        }
        .close {
            color: #123C69;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #AC3B61;
            text-decoration: none;
            cursor: pointer;
        }
        .modal form {
            display: flex;
            flex-direction: column;
        }
        .modal label {
            margin-top: 10px;
        }
        .modal input, .modal select {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #BAB2B5;
            border-radius: 3px;
        }
        .modal img {
            max-width: 100%;
            margin-bottom: 10px;
        }
        .modal .action-btn {
            margin-top: 10px;
        }
        #addNewProduct {
            background-color: #123C69;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 20px;
        }
        #addNewProduct:hover {
            background-color: #AC3B61;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>Dashboard Quản Lý Sản Phẩm Hoa</h1>

        <!-- Nút thêm sản phẩm mới -->
        <button id="addNewProduct">Thêm Sản Phẩm Mới</button>
        
        <!-- Dropdown sắp xếp theo tên và giá -->
        <select id="sortBy">
            <option value="name_asc">Tên (A-Z)</option>
            <option value="name_desc">Tên (Z-A)</option>
            <option value="price_asc">Giá (Thấp đến Cao)</option>
            <option value="price_desc">Giá (Cao đến Thấp)</option>
        </select>

        <!-- Dropdown sắp xếp theo danh mục -->
        <select id="sortCategory">
            <option value="all">Tất cả danh mục</option>
            <option value="hoa-hong">Hoa Hồng</option>
            <option value="hoa-lan">Hoa Lan</option>
            <option value="hoa-cuc">Hoa Cúc</option>
            <option value="hoa-sen">Hoa Sen</option>
            <option value="hoa-khac">Hoa Khác</option>
        </select>
        
        <!-- Bảng hiển thị sản phẩm -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên Sản Phẩm</th>
                    <th>Danh Mục</th>
                    <th>Giá (VND)</th>
                    <th>Hình Ảnh</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody id="productTable">
                <!-- Dữ liệu sẽ được thêm động bằng JavaScript -->
            </tbody>
        </table>
        
        <!-- Phân trang với Previous, Next và số trang -->
        <div id="pagination">
            <button onclick="previousPage()">Previous</button>
            <!-- Nút số trang sẽ được thêm động -->
            <button onclick="nextPage()">Next</button>
        </div>
    </div>

    <!-- Modal cho Create/Update/View/Delete -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Chi Tiết Sản Phẩm</h2>
            <form id="productForm">
                <label for="productId">ID:</label>
                <input type="text" id="productId" readonly>

                <label for="productName">Tên Sản Phẩm:</label>
                <input type="text" id="productName" required>

                <label for="productCategory">Danh Mục:</label>
                <select id="productCategory" required>
                    <option value="hoa-hong">Hoa Hồng</option>
                    <option value="hoa-lan">Hoa Lan</option>
                    <option value="hoa-cuc">Hoa Cúc</option>
                    <option value="hoa-sen">Hoa Sen</option>
                    <option value="hoa-khac">Hoa Khác</option>
                </select>

                <label for="productPrice">Giá (VND):</label>
                <input type="number" id="productPrice" required>

                <label for="productImage">Hình Ảnh (URL):</label>
                <input type="text" id="productImage" required>
                <img id="previewImage" src="" alt="Preview" style="display: none;">

                <button type="button" class="action-btn" id="saveProduct">Lưu</button>
                <button type="button" class="action-btn" id="deleteProductBtn" style="display: none;">Xóa</button>
            </form>
        </div>
    </div>

    <script>
        // Dữ liệu sản phẩm mẫu với danh mục
        let products = [
            { id: 1, name: "Hoa Hồng Đỏ", category: "hoa-hong", price: 150000, image: "https://via.placeholder.com/50?text=Hoa+Hong" },
            { id: 2, name: "Hoa Lan Trắng", category: "hoa-lan", price: 200000, image: "https://via.placeholder.com/50?text=Hoa+Lan" },
            { id: 3, name: "Hoa Cúc Vàng", category: "hoa-cuc", price: 80000, image: "https://via.placeholder.com/50?text=Hoa+Cuc" },
            { id: 4, name: "Hoa Huệ Tây", category: "hoa-khac", price: 120000, image: "https://via.placeholder.com/50?text=Hoa+Hue" },
            { id: 5, name: "Hoa Sen Hồng", category: "hoa-sen", price: 300000, image: "https://via.placeholder.com/50?text=Hoa+Sen" },
            { id: 6, name: "Hoa Đồng Tiền", category: "hoa-khac", price: 50000, image: "https://via.placeholder.com/50?text=Hoa+Dong+Tien" },
            { id: 7, name: "Hoa Lily", category: "hoa-khac", price: 180000, image: "https://via.placeholder.com/50?text=Hoa+Lily" },
            { id: 8, name: "Hoa Tulip", category: "hoa-khac", price: 250000, image: "https://via.placeholder.com/50?text=Hoa+Tulip" },
            { id: 9, name: "Hoa Oải Hương", category: "hoa-khac", price: 90000, image: "https://via.placeholder.com/50?text=Hoa+Oai+Huong" },
            { id: 10, name: "Hoa Phong Lan", category: "hoa-lan", price: 400000, image: "https://via.placeholder.com/50?text=Hoa+Phong+Lan" },
            { id: 11, name: "Hoa Cẩm Chướng", category: "hoa-khac", price: 70000, image: "https://via.placeholder.com/50?text=Hoa+Cam+Chuong" },
            { id: 12, name: "Hoa Violet", category: "hoa-khac", price: 110000, image: "https://via.placeholder.com/50?text=Hoa+Violet" },
            { id: 13, name: "Hoa Baby Breath", category: "hoa-khac", price: 60000, image: "https://via.placeholder.com/50?text=Hoa+Baby" },
            { id: 14, name: "Hoa Thủy Tiên", category: "hoa-khac", price: 130000, image: "https://via.placeholder.com/50?text=Hoa+Thuy+Tien" },
            { id: 15, name: "Hoa Mẫu Đơn", category: "hoa-khac", price: 350000, image: "https://via.placeholder.com/50?text=Hoa+Mau+Don" },
            { id: 16, name: "Hoa Cẩm Tú Cầu", category: "hoa-khac", price: 220000, image: "https://via.placeholder.com/50?text=Hoa+Cam+Tu+Cau" },
            { id: 17, name: "Hoa Hướng Dương", category: "hoa-khac", price: 100000, image: "https://via.placeholder.com/50?text=Hoa+Huong+Duong" },
            { id: 18, name: "Hoa Bách Hợp", category: "hoa-khac", price: 280000, image: "https://via.placeholder.com/50?text=Hoa+Bach+Hop" },
            { id: 19, name: "Hoa Phong Linh", category: "hoa-khac", price: 95000, image: "https://via.placeholder.com/50?text=Hoa+Phong+Linh" },
            { id: 20, name: "Hoa Địa Lan", category: "hoa-lan", price: 450000, image: "https://via.placeholder.com/50?text=Hoa+Dia+Lan" }
        ];

        let currentPage = 1;
        const perPage = 5; // Số sản phẩm mỗi trang
        let currentProductId = null; // Để theo dõi sản phẩm đang chỉnh sửa
        let isCreateMode = false; // Để phân biệt create hay update/view

        const modal = document.getElementById('productModal');
        const closeBtn = document.getElementsByClassName('close')[0];
        const saveBtn = document.getElementById('saveProduct');
        const deleteBtn = document.getElementById('deleteProductBtn');
        const addNewBtn = document.getElementById('addNewProduct');

        // Hàm mở modal cho create/update/view
        function openModal(product = null, mode = 'view') {
            currentProductId = product ? product.id : null;
            isCreateMode = (mode === 'create');

            if (isCreateMode) {
                document.getElementById('modalTitle').textContent = 'Tạo Sản Phẩm Mới';
                document.getElementById('productId').value = '';
                document.getElementById('productName').value = '';
                document.getElementById('productCategory').value = 'hoa-hong';
                document.getElementById('productPrice').value = '';
                document.getElementById('productImage').value = '';
                document.getElementById('previewImage').style.display = 'none';
                deleteBtn.style.display = 'none';
                enableFormFields();
            } else if (product) {
                document.getElementById('modalTitle').textContent = mode === 'update' ? 'Cập Nhật Sản Phẩm' : 'Xem Chi Tiết Sản Phẩm';
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productImage').value = product.image;
                document.getElementById('previewImage').src = product.image;
                document.getElementById('previewImage').style.display = 'block';
                deleteBtn.style.display = 'inline-block';

                if (mode === 'view') {
                    disableFormFields();
                    saveBtn.style.display = 'none';
                } else {
                    enableFormFields();
                    saveBtn.style.display = 'inline-block';
                    saveBtn.textContent = 'Cập Nhật';
                }
            }

            modal.style.display = 'block';
        }

        // Hàm đóng modal
        closeBtn.onclick = function() {
            modal.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            saveBtn.textContent = 'Lưu';
        }

        // Hàm vô hiệu hóa form fields cho view
        function disableFormFields() {
            document.getElementById('productName').disabled = true;
            document.getElementById('productCategory').disabled = true;
            document.getElementById('productPrice').disabled = true;
            document.getElementById('productImage').disabled = true;
        }

        // Hàm kích hoạt form fields cho update/create
        function enableFormFields() {
            document.getElementById('productName').disabled = false;
            document.getElementById('productCategory').disabled = false;
            document.getElementById('productPrice').disabled = false;
            document.getElementById('productImage').disabled = false;
        }

        // Hàm lưu sản phẩm (create/update)
        saveBtn.onclick = function() {
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const price = parseInt(document.getElementById('productPrice').value);
            const image = document.getElementById('productImage').value;

            if (!name || !category || !price || !image) {
                alert('Vui lòng điền đầy đủ thông tin!');
                return;
            }

            if (isCreateMode) {
                const newId = products.length + 1;
                products.push({ id: newId, name, category, price, image });
            } else {
                const product = products.find(p => p.id === currentProductId);
                if (product) {
                    product.name = name;
                    product.category = category;
                    product.price = price;
                    product.image = image;
                }
            }

            modal.style.display = 'none';
            displayProducts(currentPage, document.getElementById('sortBy').value, document.getElementById('sortCategory').value);
        }

        // Hàm xóa sản phẩm từ modal
        deleteBtn.onclick = function() {
            deleteProduct(currentProductId);
            modal.style.display = 'none';
        }

        // Sự kiện cho nút thêm mới
        addNewBtn.onclick = function() {
            openModal(null, 'create');
        }

        // Hàm sắp xếp sản phẩm
        function sortProducts(sortBy, categoryFilter) {
            let sortedProducts = [...products];
            if (categoryFilter !== 'all') {
                sortedProducts = sortedProducts.filter(p => p.category === categoryFilter);
            }
            if (sortBy === 'name_asc') {
                sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sortBy === 'name_desc') {
                sortedProducts.sort((a, b) => b.name.localeCompare(a.name));
            } else if (sortBy === 'price_asc') {
                sortedProducts.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price_desc') {
                sortedProducts.sort((a, b) => b.price - a.price);
            }
            return sortedProducts;
        }

        // Hàm hiển thị sản phẩm theo trang, sắp xếp và bộ lọc danh mục
        function displayProducts(page = 1, sort = 'name_asc', category = 'all') {
            currentPage = page;
            const sortedProducts = sortProducts(sort, category);
            const start = (page - 1) * perPage;
            const end = start + perPage;
            const paginatedProducts = sortedProducts.slice(start, end);

            let html = '';
            paginatedProducts.forEach(product => {
                html += `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.category.replace('hoa-', 'Hoa ').replace(/-/g, ' ')}</td>
                        <td>${product.price.toLocaleString('vi-VN')}</td>
                        <td><img src="${product.image}" alt="${product.name}" width="50"></td>
                        <td>
                            <button class="action-btn" onclick="openModal(products.find(p => p.id === ${product.id}), 'view')">Xem</button>
                            <button class="action-btn" onclick="openModal(products.find(p => p.id === ${product.id}), 'update')">Sửa</button>
                            <button class="action-btn" onclick="deleteProduct(${product.id})">Xóa</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('productTable').innerHTML = html;
            updatePagination(sortedProducts.length, sort, category);
        }

        // Hàm cập nhật nút phân trang
        function updatePagination(totalItems, sort, category) {
            const totalPages = Math.ceil(totalItems / perPage);
            let html = '';
            if (currentPage > 1) {
                html += `<button onclick="displayProducts(${currentPage - 1}, '${sort}', '${category}')">Previous</button>`;
            }
            for (let i = 1; i <= totalPages; i++) {
                html += `<button ${i === currentPage ? 'style="background-color: #AC3B61;"' : ''} onclick="displayProducts(${i}, '${sort}', '${category}')">${i}</button>`;
            }
            if (currentPage < totalPages) {
                html += `<button onclick="displayProducts(${currentPage + 1}, '${sort}', '${category}')">Next</button>`;
            }
            document.getElementById('pagination').innerHTML = html;
        }

        // Hàm chuyển trang trước
        function previousPage() {
            if (currentPage > 1) {
                displayProducts(currentPage - 1, document.getElementById('sortBy').value, document.getElementById('sortCategory').value);
            }
        }

        // Hàm chuyển trang sau
        function nextPage() {
            const totalPages = Math.ceil(products.length / perPage);
            if (currentPage < totalPages) {
                displayProducts(currentPage + 1, document.getElementById('sortBy').value, document.getElementById('sortCategory').value);
            }
        }

        // Event listener cho sắp xếp
        document.getElementById('sortBy').addEventListener('change', function() {
            displayProducts(1, this.value, document.getElementById('sortCategory').value);
        });

        // Event listener cho bộ lọc danh mục
        document.getElementById('sortCategory').addEventListener('change', function() {
            displayProducts(1, document.getElementById('sortBy').value, this.value);
        });

        // Hàm sửa sản phẩm (mở modal ở chế độ update)
        function editProduct(id) {
            const product = products.find(p => p.id === id);
            openModal(product, 'update');
        }

        // Hàm xóa sản phẩm
        function deleteProduct(id) {
            if (confirm(`Xác nhận xóa sản phẩm ID: ${id}?`)) {
                products = products.filter(p => p.id !== id);
                displayProducts(currentPage, document.getElementById('sortBy').value, document.getElementById('sortCategory').value);
            }
        }

        // Khởi tạo ban đầu
        displayProducts(1, 'name_asc', 'all');
    </script>
</body>
</html>